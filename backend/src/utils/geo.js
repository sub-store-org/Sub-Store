const { HTTP } = require('./open-api');

// get proxy flag according to its name
function getFlag(name) {
	// flags from @KOP-XIAO: https://github.com/KOP-XIAO/QuantumultX/blob/master/Scripts/resource-parser.js
	const flags = {
		'ðŸ‡¦ðŸ‡¿': [ 'é˜¿å¡žæ‹œç–†' ],
		'ðŸ‡¦ðŸ‡¹': [ 'å¥¥åœ°åˆ©', 'å¥§åœ°åˆ©', 'Austria', 'ç»´ä¹Ÿçº³' ],
		'ðŸ‡¦ðŸ‡º': [ 'AU', 'Australia', 'Sydney', 'æ¾³å¤§åˆ©äºš', 'æ¾³æ´²', 'å¢¨å°”æœ¬', 'æ‚‰å°¼', 'åœŸæ¾³', 'äº¬æ¾³', 'å»£æ¾³', 'æ»¬æ¾³', 'æ²ªæ¾³', 'å¹¿æ¾³' ],
		'ðŸ‡§ðŸ‡ª': [ 'BE', 'æ¯”åˆ©æ™‚', 'æ¯”åˆ©æ—¶' ],
		'ðŸ‡§ðŸ‡¬': [ 'ä¿åŠ åˆ©äºš', 'ä¿åŠ åˆ©äºž', 'Bulgaria' ],
		'ðŸ‡§ðŸ‡­': [ 'BH', 'å·´æž—' ],
		'ðŸ‡§ðŸ‡©': [ 'BD', 'å­ŸåŠ æ‹‰' ],
		'ðŸ‡µðŸ‡°': [ 'å·´åŸºæ–¯å¦' ],
		'ðŸ‡°ðŸ‡­': [ 'æŸ¬åŸ”å¯¨' ],
		'ðŸ‡ºðŸ‡¦': [ 'çƒå…‹è˜­', 'ä¹Œå…‹å…°' ],
		'ðŸ‡­ðŸ‡·': [ 'å…‹ç½—åœ°äºš', 'HR', 'å…‹ç¾…åœ°äºž' ],
		'ðŸ‡¨ðŸ‡¦': [ 'Canada', 'CANADA', 'CAN', 'Waterloo', 'åŠ æ‹¿å¤§', 'è’™ç‰¹åˆ©å°”', 'æ¸©å“¥åŽ', 'æ¥“è‘‰', 'æž«å¶', 'æ»‘é“å¢', 'å¤šä¼¦å¤š', 'CA' ],
		'ðŸ‡¨ðŸ‡­': [ 'ç‘žå£«', 'è‹é»Žä¸–', 'Switzerland', 'Zurich' ],
		'ðŸ‡³ðŸ‡¬': [ 'å°¼æ—¥åˆ©äºš', 'NG', 'å°¼æ—¥åˆ©äºž' ],
		'ðŸ‡¨ðŸ‡¿': [ 'Czechia', 'æ·å…‹' ],
		'ðŸ‡¸ðŸ‡°': [ 'æ–¯æ´›ä¼å…‹', 'SK' ],
		'ðŸ‡·ðŸ‡¸': [ 'RS', 'å¡žå°”ç»´äºš' ],
		'ðŸ‡²ðŸ‡©': [ 'æ‘©çˆ¾å¤šç“¦', 'MD', 'æ‘©å°”å¤šç“¦' ],
		'ðŸ‡©ðŸ‡ª': [ 'DE', 'German', 'GERMAN', 'å¾·å›½', 'å¾·åœ‹', 'æ³•å…°å…‹ç¦', 'äº¬å¾·', 'æ»¬å¾·', 'å»£å¾·', 'æ²ªå¾·', 'å¹¿å¾·', 'Frankfurt' ],
		'ðŸ‡©ðŸ‡°': [ 'DK', 'DNK', 'ä¸¹éº¦', 'ä¸¹éº¥' ],
		'ðŸ‡ªðŸ‡¸': [ 'ES', 'è¥¿ç­ç‰™', 'Spain' ],
		'ðŸ‡ªðŸ‡º': [ 'EU', 'æ¬§ç›Ÿ', 'æ¬§ç½—å·´' ],
		'ðŸ‡«ðŸ‡®': [ 'Finland', 'èŠ¬å…°', 'èŠ¬è˜­', 'èµ«å°”è¾›åŸº' ],
		'ðŸ‡«ðŸ‡·': [ 'FR', 'France', 'æ³•å›½', 'æ³•åœ‹', 'å·´é»Ž' ],
		'ðŸ‡¬ðŸ‡§': [ 'UK', 'GB', 'England', 'United Kingdom', 'è‹±å›½', 'ä¼¦æ•¦', 'è‹±', 'London' ],
		'ðŸ‡²ðŸ‡´': [ 'MO', 'Macao', 'æ¾³é—¨', 'æ¾³é–€', 'CTM' ],
		'ðŸ‡°ðŸ‡¿': [ 'å“ˆè¨å…‹æ–¯å¦', 'å“ˆè¨å…‹' ],
		'ðŸ‡­ðŸ‡º': [ 'åŒˆç‰™åˆ©', 'Hungary' ],
		'ðŸ‡­ðŸ‡°': [
			'HK',
			'Hongkong',
			'Hong Kong',
			'HongKong',
			'HONG KONG',
			'é¦™æ¸¯',
			'æ·±æ¸¯',
			'æ²ªæ¸¯',
			'å‘¼æ¸¯',
			'HKT',
			'HKBN',
			'HGC',
			'WTT',
			'CMI',
			'ç©—æ¸¯',
			'äº¬æ¸¯',
			'æ¸¯'
		],
		'ðŸ‡®ðŸ‡©': [ 'Indonesia', 'å°å°¼', 'å°åº¦å°¼è¥¿äºš', 'é›…åŠ è¾¾' ],
		'ðŸ‡®ðŸ‡ª': [ 'Ireland', 'IRELAND', 'çˆ±å°”å…°', 'æ„›çˆ¾è˜­', 'éƒ½æŸæž—' ],
		'ðŸ‡®ðŸ‡±': [ 'Israel', 'ä»¥è‰²åˆ—' ],
		'ðŸ‡®ðŸ‡³': [ 'India', 'IND', 'INDIA', 'å°åº¦', 'å­Ÿä¹°', 'MFumbai' ],
		'ðŸ‡®ðŸ‡¸': [ 'IS', 'ISL', 'å†°å²›', 'å†°å³¶' ],
		'ðŸ‡°ðŸ‡µ': [ 'KP', 'æœé²œ' ],
		'ðŸ‡°ðŸ‡·': [ 'KR', 'Korea', 'KOR', 'éŸ©å›½', 'é¦–å°”', 'éŸ©', 'éŸ“', 'æ˜¥å·', 'Chuncheon', 'Seoul' ],
		'ðŸ‡±ðŸ‡º': [ 'å¢æ£®å ¡' ],
		'ðŸ‡±ðŸ‡»': [ 'Latvia', 'Latvija', 'æ‹‰è„±ç»´äºš' ],
		'ðŸ‡²ðŸ‡½': [ 'MEX', 'MX', 'å¢¨è¥¿å“¥' ],
		'ðŸ‡²ðŸ‡¾': [ 'MY', 'Malaysia', 'MALAYSIA', 'é©¬æ¥è¥¿äºš', 'å¤§é¦¬', 'é¦¬ä¾†è¥¿äºž', 'å‰éš†å¡' ],
		'ðŸ‡³ðŸ‡±': [ 'NL', 'Netherlands', 'è·å…°', 'è·è˜­', 'å°¼å¾·è˜­', 'é˜¿å§†æ–¯ç‰¹ä¸¹' ],
		'ðŸ‡³ðŸ‡µ': [ 'å°¼æ³Šå°”' ],
		'ðŸ‡µðŸ‡­': [ 'PH', 'Philippines', 'è²å¾‹å®¾', 'è²å¾‹è³“' ],
		'ðŸ‡µðŸ‡·': [ 'PR', 'æ³¢å¤šé»Žå„' ],
		'ðŸ‡·ðŸ‡´': [ 'RO', 'ç½—é©¬å°¼äºš' ],
		'ðŸ‡·ðŸ‡º': [
			'RU',
			'Russia',
			'ä¿„ç½—æ–¯',
			'ä¿„å›½',
			'ä¿„ç¾…æ–¯',
			'ä¼¯åŠ›',
			'èŽ«æ–¯ç§‘',
			'åœ£å½¼å¾—å ¡',
			'è¥¿ä¼¯åˆ©äºš',
			'æ–°è¥¿ä¼¯åˆ©äºš',
			'äº¬ä¿„',
			'æ­ä¿„',
			'å»£ä¿„',
			'æ»¬ä¿„',
			'å¹¿ä¿„',
			'æ²ªä¿„',
			'Moscow'
		],
		'ðŸ‡¸ðŸ‡¦': [ 'æ²™ç‰¹' ],
		'ðŸ‡¸ðŸ‡ª': [ 'SE', 'Sweden', 'ç‘žå…¸' ],
		'ðŸ‡²ðŸ‡¹': [ 'é©¬è€³ä»–' ],
		'ðŸ‡²ðŸ‡¦': [ 'MA', 'æ‘©æ´›å“¥' ],
		'ðŸ‡¸ðŸ‡¬': [ 'SG', 'Singapore', 'SINGAPORE', 'æ–°åŠ å¡', 'ç‹®åŸŽ', 'æ²ªæ–°', 'äº¬æ–°', 'æ³‰æ–°', 'ç©—æ–°', 'æ·±æ–°', 'æ­æ–°', 'å¹¿æ–°', 'å»£æ–°', 'æ»¬æ–°' ],
		'ðŸ‡¹ðŸ‡­': [ 'TH', 'Thailand', 'æ³°å›½', 'æ³°åœ‹', 'æ›¼è°·' ],
		'ðŸ‡¹ðŸ‡·': [ 'TR', 'Turkey', 'åœŸè€³å…¶', 'ä¼Šæ–¯å¦å¸ƒå°”' ],
		'ðŸ‡¹ðŸ‡¼': [ 'TW', 'Taiwan', 'TAIWAN', 'å°æ¹¾', 'å°åŒ—', 'å°ä¸­', 'æ–°åŒ—', 'å½°åŒ–', 'CHT', 'å°', 'HINET', 'Taipei' ],
		'ðŸ‡ºðŸ‡¸': [
			'US',
			'USA',
			'America',
			'United States',
			'ç¾Žå›½',
			'ç¾Ž',
			'äº¬ç¾Ž',
			'æ³¢ç‰¹å…°',
			'è¾¾æ‹‰æ–¯',
			'ä¿„å‹’å†ˆ',
			'å‡¤å‡°åŸŽ',
			'è´¹åˆ©è’™',
			'ç¡…è°·',
			'çŸ½è°·',
			'æ‹‰æ–¯ç»´åŠ æ–¯',
			'æ´›æ‰çŸ¶',
			'åœ£ä½•å¡ž',
			'åœ£å…‹æ‹‰æ‹‰',
			'è¥¿é›…å›¾',
			'èŠåŠ å“¥',
			'æ²ªç¾Ž',
			'å“¥ä¼¦å¸ƒ',
			'çº½çº¦',
			'Los Angeles',
			'San Jose',
			'Sillicon Valley',
			'Michigan'
		],
		'ðŸ‡»ðŸ‡³': [ 'VN', 'è¶Šå—', 'èƒ¡å¿—æ˜Žå¸‚' ],
		'ðŸ‡»ðŸ‡ª': [ 'VE', 'å§”å†…ç‘žæ‹‰' ],
		'ðŸ‡®ðŸ‡¹': [ 'Italy', 'IT', 'Nachash', 'æ„å¤§åˆ©', 'ç±³å…°', 'ç¾©å¤§åˆ©' ],
		'ðŸ‡¿ðŸ‡¦': [ 'South Africa', 'å—éž' ],
		'ðŸ‡¦ðŸ‡ª': [ 'United Arab Emirates', 'é˜¿è”é…‹', 'è¿ªæ‹œ', 'AE' ],
		'ðŸ‡§ðŸ‡·': [ 'BR', 'Brazil', 'å·´è¥¿', 'åœ£ä¿ç½—' ],
		'ðŸ‡¯ðŸ‡µ': [
			'JP',
			'Japan',
			'JAPAN',
			'æ—¥æœ¬',
			'ä¸œäº¬',
			'å¤§é˜ª',
			'åŸ¼çŽ‰',
			'æ²ªæ—¥',
			'ç©—æ—¥',
			'å·æ—¥',
			'ä¸­æ—¥',
			'æ³‰æ—¥',
			'æ­æ—¥',
			'æ·±æ—¥',
			'è¾½æ—¥',
			'å¹¿æ—¥',
			'å¤§å‚',
			'Osaka',
			'Tokyo'
		],
		'ðŸ‡¦ðŸ‡·': [ 'AR', 'é˜¿æ ¹å»·' ],
		'ðŸ‡³ðŸ‡´': [ 'Norway', 'æŒªå¨', 'NO' ],
		'ðŸ‡¨ðŸ‡³': [ 'CN', 'China', 'å›žå›½', 'ä¸­å›½', 'ä¸­åœ‹', 'æ±Ÿè‹', 'åŒ—äº¬', 'ä¸Šæµ·', 'å¹¿å·ž', 'æ·±åœ³', 'æ­å·ž', 'å¾å·ž', 'é’å²›', 'å®æ³¢', 'é•‡æ±Ÿ', 'back' ],
		'ðŸ‡µðŸ‡±': [ 'PL', 'POL', 'æ³¢å…°', 'æ³¢è˜­' ],
		'ðŸ‡¨ðŸ‡±': [ 'æ™ºåˆ©' ],
		'ðŸ‡³ðŸ‡¿': [ 'æ–°è¥¿è˜­', 'æ–°è¥¿å…°' ],
		'ðŸ‡¬ðŸ‡·': [ 'å¸Œè…Š', 'å¸Œè‡˜' ],
		'ðŸ‡ªðŸ‡¬': [ 'åŸƒåŠ' ],
		'ðŸ‡¨ðŸ‡¾': [ 'CY', 'å¡žæµ¦è·¯æ–¯' ],
		'ðŸ‡¨ðŸ‡·': [ 'CR', 'å“¥æ–¯è¾¾é»ŽåŠ ' ],
		'ðŸ‡¸ðŸ‡®': [ 'SI', 'æ–¯æ´›æ–‡å°¼äºš' ],
		'ðŸ‡±ðŸ‡¹': [ 'LT', 'ç«‹é™¶å®›' ],
		'ðŸ‡µðŸ‡¦': [ 'PA', 'å·´æ‹¿é©¬' ],
		'ðŸ‡¹ðŸ‡³': [ 'TN', 'çªå°¼æ–¯' ],
		'ðŸ‡®ðŸ‡²': [ 'é©¬æ©å²›', 'é¦¬æ©å³¶' ],
		'ðŸ‡§ðŸ‡¾': [ 'BY', 'ç™½ä¿„', 'ç™½ä¿„ç½—æ–¯' ],
		'ðŸ‡µðŸ‡¹': [ 'è‘¡è„ç‰™' ],
		'ðŸ‡°ðŸ‡ª': [ 'KE', 'è‚¯å°¼äºš' ],
		'ðŸ‡°ðŸ‡¬': [ 'KG', 'å‰å°”å‰æ–¯å¦' ],
		'ðŸ‡¯ðŸ‡´': [ 'JO', 'çº¦æ—¦' ],
		'ðŸ‡ºðŸ‡¾': [ 'UY', 'ä¹Œæ‹‰åœ­' ],
		'ðŸ‡²ðŸ‡³': [ 'è’™å¤' ],
		'ðŸ‡®ðŸ‡·': [ 'IR', 'ä¼Šæœ—' ],
		'ðŸ‡µðŸ‡ª': [ 'ç§˜é²', 'ç¥•é­¯' ],
		'ðŸ‡¨ðŸ‡´': [ 'å“¥ä¼¦æ¯”äºš' ],
		'ðŸ‡ªðŸ‡ª': [ 'çˆ±æ²™å°¼äºš' ],
		'ðŸ‡ªðŸ‡¨': [ 'EC', 'åŽ„ç“œå¤šå°”' ],
		'ðŸ‡²ðŸ‡°': [ 'é©¬å…¶é¡¿', 'é¦¬å…¶é “' ],
		'ðŸ‡§ðŸ‡¦': [ 'æ³¢é»‘å…±å’Œå›½', 'æ³¢é»‘' ],
		'ðŸ‡¬ðŸ‡ª': [ 'æ ¼é­¯å‰äºž', 'æ ¼é²å‰äºš' ],
		'ðŸ‡¦ðŸ‡±': [ 'é˜¿çˆ¾å·´å°¼äºž', 'é˜¿å°”å·´å°¼äºš' ],
		'ðŸ³ï¸â€ðŸŒˆ': [ 'æµé‡', 'æ—¶é—´', 'åº”æ€¥', 'è¿‡æœŸ', 'Bandwidth', 'expire' ]
	};
	for (let k of Object.keys(flags)) {
		if (flags[k].some((item) => name.indexOf(item) !== -1)) {
			return k;
		}
	}
	// no flag found
	const oldFlag = (name.match(/[\uD83C][\uDDE6-\uDDFF][\uD83C][\uDDE6-\uDDFF]/) || [])[0];
	return oldFlag || 'ðŸ´â€â˜ ï¸';
}

// util API
async function IP_API(req, res) {
	const server = decodeURIComponent(req.params.server);
	const $http = HTTP();
	const result = await $http
		.get(`http://ip-api.com/json/${server}?lang=zh-CN`)
		.then((resp) => JSON.parse(resp.body));
	res.json(result);
}

module.exports = {
	getFlag,
	IP_API
};
